# NPM ç§æœ‰ä»“åº“æ­å»º

> å‰è¨€ï¼šç”±äºå…¬å¸æœåŠ¡å™¨æ›´æ¢å¯¼è‡´ä¹‹å‰æ­å»ºçš„`NPM`ç§åº“æŒ‚äº†ï¼Œæ­£å¥½é¡ºå¸¦è®°å½•ä¸€ä¸‹æ­å»ºç§åº“çš„æµç¨‹ğŸ˜„ã€‚

#### ä¸ºä»€ä¹ˆè¦æ­å»º npm ç§åº“

ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨çš„npmæºæˆ–è€…å›½å†…é•œåƒæºéƒ½æ˜¯å°†åŒ…å­˜å‚¨åœ¨å¤–ç½‘ï¼Œéƒ¨ç½²çš„åŒ…ä¸å…·æœ‰ç§å¯†æ€§ï¼Œå½“ä½ éœ€è¦éƒ¨ç½²ä¸€ä¸ªå…¬å¸å†…éƒ¨ä½¿ç”¨çš„ç»„ä»¶åº“æˆ–è€…è§£è€¦ç‹¬ç«‹å‡ºä¸€äº›å·¥å…·åŒ…æ—¶ã€‚è¿™æ—¶ï¼Œnpmç§åº“å°±ä¼šæ´¾ä¸Šç”¨åœºäº†ã€‚

#### linux æœåŠ¡å™¨å‡†å¤‡å·¥ä½œ

**å®‰è£… `node` ç¯å¢ƒ** [ Node.js ä¸­æ–‡ç½‘](http://nodejs.cn/download/)

- ä¸‹è½½å®‰è£…åŒ…ï¼ˆç½‘é€Ÿä¸å¥½æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åœ¨winç¯å¢ƒä¸‹è½½linuxåŒ…å†ä¸Šä¼ ï¼‰
  
  ```shell
  # è¿™é‡Œä»¥æœ€æ–°ç‰ˆä¸ºä¾‹
  wget https://npmmirror.com/mirrors/node/v16.14.2/node-v16.14.2-linux-x64.tar.xz
  ```

- è§£å‹
  
  ```shell
  # è§£å‹åç”Ÿæˆ node-v16.14.2-linux-x64
  tar -zxv node-v16.14.2-linux-x64.tar.xz
  ```

- æ·»åŠ ç¯å¢ƒå˜é‡ï¼ˆæˆ–è½¯è¿æ¥ï¼‰
  
  è§£å‹å®Œæˆä¹‹åï¼Œä»…åœ¨`node-v16.14.2-linux-x64/bin`æ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨`node`å‘½ä»¤ã€‚æ‰€ä»¥éœ€è¦æ­¤æ­¥éª¤ï¼Œè®©æˆ‘ä»¬åœ¨ä»»ä½•ç›®å½•ä¸‹å‡å¯ä»¥ä½¿ç”¨
  
  ```shell
  # ä½¿ç”¨vimç¼–è¾‘ï¼Œæœªå®‰è£…éœ€æå‰å®‰è£…
  vi /etc/profile
  
  # åœ¨æœ€åä¸€è¡Œæ’å…¥
  # å°†ä¸‹æ–¹...æ›¿æ¢ä¸ºä½ çš„å®‰è£…ç›®å½•
  :export PATH=$PATH:/.../node-v16.14.2-linux-x64/bin
  
  # ä¿å­˜é€€å‡ºï¼Œæ‰§è¡Œé…ç½®ç”Ÿæ•ˆ
  source /etc/profile
  ```

- æµ‹è¯•
  
  ```shell
  # node ç‰ˆæœ¬å·
  node -v
  v16.14.2
  
  # npm ç‰ˆæœ¬å·
  npm -v
  v8.5.0
  ```

#### å¼€å§‹æ­å»º

**1.  å®‰è£…ç§åº“åŒ… `verdaccio`**

```shell
# å…ˆè®¾ç½®å›½å†…npmé•œåƒæºï¼ŒåŠ å¿«ä¸‹è½½é€Ÿåº¦
npm config set registry https://registry.npmmirror.com/

# å®‰è£… verdaccio
npm i -g verdaccio

# æµ‹è¯•
verdaccio -v
v5.10.0
```

**2.  å¯åŠ¨ `verdaccio`**

```shell
# ç›´æ¥æ‰§è¡Œ å‡ºç°ä»¥ä¸‹æ—¥å¿—æ‰“å°åˆ™å¯åŠ¨æˆåŠŸ
verdaccio

 info --- Creating default config file in /home/deploy/verdaccio/config.yaml
 warn --- config file  - /home/deploy/verdaccio/config.yaml
(node:18079) Warning: Verdaccio doesn't need superuser privileges. don't run it under root
(Use `node --trace-warnings ...` to show where the warning was created)
(node:18079) [LRU_CACHE_OPTION_maxAge] DeprecationWarning: The maxAge option is deprecated. Please use options.ttl instead.
(node:18079) Warning: Verdaccio doesn't need superuser privileges. don't run it under root
 warn --- Plugin successfully loaded: verdaccio-htpasswd
 warn --- Plugin successfully loaded: verdaccio-audit
 warn --- http address - http://localhost:4873/ - verdaccio/5.10.0
```

ç°åœ¨ä½ å¯ä»¥åœ¨æœ¬æœºæŸ¥çœ‹åˆ°4873ç«¯å£å·²æˆåŠŸå¼€å¯`verdaccio`æœåŠ¡

```shell
# æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ
netstat -ntulp |grep 4873

# æ˜¾ç¤ºç»“æœç±»ä¼¼å¦‚ä¸‹
tcp     0    localhost:4873     LISTEN      xxxx/Verdaccio
```

è¿™ä¸ªæ—¶å€™ä½ å¯èƒ½å¼€å§‹å°è¯•ç”¨æœ¬æœºæµè§ˆå™¨è®¿é—®æœåŠ¡å™¨`ip:4873`, ç»“æœä»ç„¶è®¿é—®å¤±è´¥â˜¹ã€‚æ‰€ä»¥ä½ è¦å¼€å§‹ä¿®æ”¹verdaccioé»˜è®¤é…ç½®äº†ã€‚

**3. verdaccio é…ç½®**

`localhost`æˆ–è€…`127.0.0.1`åªå¯ä»¥åœ¨åŒä¸»æœºä¸Šè®¿é—®ï¼Œè¦æƒ³åœ¨ä»»ä½•ä¸»æœºåœ°å€è®¿é—®åˆ°æœåŠ¡å™¨ä¸ŠæŸç«¯å£ï¼Œéœ€è¦ä¿®æ”¹ä¸º`0.0.0.0:port`ã€‚

å¯åŠ¨`verdaccio`åï¼Œå…¶è‡ªåŠ¨åœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼š`storage`ã€`verdaccio`, æˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„é…ç½®æ–‡ä»¶åœ¨`verdaccio/config.yaml`ä½ç½®ã€‚

```shell
vi verdaccio/config.yaml

# æŸ¥æ‰¾åˆ° listen è¿™ä¸€è¡Œï¼Œå–æ¶ˆlistenæ³¨é‡Šå¹¶è¿½åŠ åœ°å€
listen: 0.0.0.0:4873

# æŸ¥æ‰¾ publish è¿™ä¸€è¡Œ
publish:
  allow_offline: true # å…è®¸ç¦»çº¿å‘å¸ƒ
```

æ›´å¤šé…ç½®å¯äº†è§£ [verdaccioæ–‡æ¡£](https://verdaccio.org/docs/what-is-verdaccio)

è¿™æ—¶æˆ‘ä»¬å†å¯åŠ¨ `verdaccio`ï¼Œå‘ç°ä¸€åˆ‡éƒ½å¤§åŠŸå‘Šæˆäº†ã€‚

No, å½“æˆ‘ä»¬å®Œæˆé€€å‡ºæœåŠ¡å™¨è¿æ¥æ—¶ï¼Œå‘ç°å¯åŠ¨çš„æœåŠ¡ä¹Ÿè‡ªåŠ¨å…³é—­äº†ã€‚æ‰€ä»¥ï¼Œæœ‰äº†ä¸€ä¸ªå«è¿›ç¨‹å®ˆæŠ¤çš„ä¸œè¥¿ --`pm2`ã€‚

#### éƒ¨ç½²æœåŠ¡

pm2ï¼šç”¨äºå°†æˆ‘ä»¬å‰å°å¼€å¯çš„nodeæœåŠ¡è½¬å˜ä¸ºåå°æŒ‚èµ·çŠ¶æ€ï¼Œå¹¶å¯¹å…¶çŠ¶æ€è¿›è¡Œç›‘æµ‹ç®¡ç†ã€‚

```shell
npm i -g pm2

# æµ‹è¯•
pm2 -v
5.2.0

# ä½¿ç”¨ pm2 å¯åŠ¨ verdaccio ï¼ˆå…ˆç»“æŸæ‰ä¹‹å‰å¼€å¯çš„verdaccioï¼‰
pm2 start `which verdaccio`

# æŸ¥çœ‹pm2å†…æœåŠ¡çŠ¶æ€
pm2 ls
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name         â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ verdaccio    â”‚ default     â”‚ N/A     â”‚ fork    â”‚ 7488     â”‚ 15h    â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 114.4mb  â”‚ root     â”‚ disabled â”‚
â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
# æœ€åæ£€æŸ¥ç«¯å£æƒ…å†µ
netstat -ntulp |grep 4873
tcp     0    0.0.0.0:4873     LISTEN      7488/Verdaccio
```

æœ€åï¼Œè‹¥æœåŠ¡å™¨å¼€å¯é˜²ç«å¢™åˆ™éœ€è¦å°†4873ç«¯å£æ”¾è¡Œï¼Œè‹¥ç±»ä¼¼é˜¿é‡Œäº‘ç­‰äº‘æœåŠ¡å™¨éœ€å¹³å°å¼€æ”¾ç«¯å£æ‰å¯è®¿é—®ï¼Œæœ€åå³å¯å®Œæˆæœ¬åœ°çš„ç§åº“è®¿é—®äº†ã€‚

### å‘å¸ƒç¬¬ä¸€ä¸ªåŒ…

```shell
# è®¾ç½®npmæºä¸ºæœåŠ¡å™¨ç§åº“åœ°å€ ï¼ˆå»ºè®®ä½¿ç”¨yrmç®¡ç†å¤šæºåˆ‡æ¢ï¼‰
npm config set registry http://*****:4873

# é¦–æ¬¡å‘åŒ…éœ€è¦æ·»åŠ npmè´¦å· æŒ‰ç…§æç¤ºå¡«å†™ç”¨æˆ·åã€å¯†ç ã€é‚®ç®±
npm adduser 

# å‘å¸ƒä½ çš„ç¬¬ä¸€ä¸ªåŒ…å§ï¼
npm publish 
```